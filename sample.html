<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Firestore Data Display</title>
    <script type="module">
        // Firebase SDKをインポート
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.0.0/firebase-app.js";
        import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/9.0.0/firebase-firestore.js";

        // Firebaseの設定
        const firebaseConfig = {
          apiKey: "AIzaSyAnf22xkIpGaLTMNDkjYL-e4ochtbkfYJ4",
          authDomain: "mido-96308.firebaseapp.com",
          projectId: "mido-96308",
          storageBucket: "mido-96308.appspot.com",
          messagingSenderId: "574980077608",
          appId: "1:574980077608:web:5065ea7bd43efaea31dd1d"
        };
        

        // Firebase初期化
        const app = initializeApp(firebaseConfig);
        
        const db = getFirestore(app);

        async function displayData() {
            try {
                const today = new Date();
                const options = { year: 'numeric', month: '2-digit', day: '2-digit', timeZone: 'Asia/Tokyo' };
                const currentDate = today.toLocaleDateString('ja-JP', options).replace(/\//g, '-');
                const yesterday = new Date(today);
                yesterday.setDate(today.getDate() - 1);
                const yesterdayDate = yesterday.toLocaleDateString('ja-JP', options).replace(/\//g, '-');

                // 今日のドキュメントを取得
                const currentDocRef = doc(db, 'daily_challenge', currentDate);
                const currentDoc = await getDoc(currentDocRef);

                if (currentDoc.exists()) {
                    const data = currentDoc.data();
                    if (data.token) {
                        document.getElementById('current-token').innerText = `Today's Token: ${data.token}`;
                    }
                } else {
                    document.getElementById('current-token').innerText = "Today's document does not exist.";
                }

                // 昨日のドキュメントを取得
                const yesterdayDocRef = doc(db, 'daily_challenge', yesterdayDate);
                const yesterdayDoc = await getDoc(yesterdayDocRef);

                if (yesterdayDoc.exists()) {
                    const yesterdayData = yesterdayDoc.data();
                    if (yesterdayData.items) {  // itemsフィールドが存在するか確認
                        const items = yesterdayData.items.filter(item => item.totalScore > 0);

                        let itemsHtml = "<h2>Yesterday's Items:</h2>";
                        items.forEach(item => {
                            itemsHtml += `<div class="item">Player: ${item.playerName}, User ID: ${item.userId}, Total Score: ${item.totalScore}</div>`;
                        });

                        document.getElementById('yesterday-items').innerHTML = itemsHtml;
                    } else {
                        document.getElementById('yesterday-items').innerText = "Yesterday's items data does not exist.";
                    }
                } else {
                    document.getElementById('yesterday-items').innerText = "Yesterday's document does not exist.";
                }
            } catch (error) {
                console.error("Error fetching Firestore data:", error);
                document.getElementById('current-token').innerText = "データ取得中にエラーが発生しました。";
                document.getElementById('yesterday-items').innerText = "データ取得中にエラーが発生しました。";
            }
        }

        // データを表示
        displayData();
    </script>
    <style>
        body {
            font-family: Arial, sans-serif;
        }
        .item {
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <h1>Firestore Data Display</h1>
    <div id="current-token"></div>
    <div id="yesterday-items"></div>
</body>
</html>
