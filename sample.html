<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Firestore Data Display</title>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-firestore.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
        }
        .item {
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <h1>Firestore Data Display</h1>
    <div id="current-token"></div>
    <div id="yesterday-items"></div>

    <script>
        const firebaseConfig = {
            apiKey: "YOUR_API_KEY",
            authDomain: "YOUR_PROJECT_ID.firebaseapp.com",
            projectId: "YOUR_PROJECT_ID",
            storageBucket: "YOUR_PROJECT_ID.appspot.com",
            messagingSenderId: "YOUR_MESSAGING_SENDER_ID",
            appId: "YOUR_APP_ID"
        };

        const app = firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        async function displayData() {
            try {
                const today = new Date();
                const options = { year: 'numeric', month: '2-digit', day: '2-digit', timeZone: 'Asia/Tokyo' };
                const currentDate = today.toLocaleDateString('ja-JP', options).replace(/\//g, '-');
                const yesterday = new Date(today);
                yesterday.setDate(today.getDate() - 1);
                const yesterdayDate = yesterday.toLocaleDateString('ja-JP', options).replace(/\//g, '-');

                // 今日のドキュメントを取得
                const currentDocRef = db.collection('daily_challenge').doc(currentDate);
                const currentDoc = await currentDocRef.get();

                if (currentDoc.exists) {
                    const data = currentDoc.data();
                    if (data.token) {
                        document.getElementById('current-token').innerText = `Today's Token: ${data.token}`;
                    }
                } else {
                    document.getElementById('current-token').innerText = "Today's document does not exist.";
                }

                // 昨日のドキュメントを取得
                const yesterdayDocRef = db.collection('daily_challenge').doc(yesterdayDate);
                const yesterdayDoc = await yesterdayDocRef.get();

                if (yesterdayDoc.exists) {
                    const yesterdayData = yesterdayDoc.data();
                    const items = yesterdayData.item.filter(item => item.totalScore > 0);

                    let itemsHtml = "<h2>Yesterday's Items:</h2>";
                    items.forEach(item => {
                        itemsHtml += `<div class="item">Player: ${item.playerName}, User ID: ${item.userId}, Total Score: ${item.totalScore}</div>`;
                    });

                    document.getElementById('yesterday-items').innerHTML = itemsHtml;
                } else {
                    document.getElementById('yesterday-items').innerText = "Yesterday's document does not exist.";
                }
            } catch (error) {
                console.error("Error fetching Firestore data:", error);
                document.getElementById('current-token').innerText = "データ取得中にエラーが発生しました。";
                document.getElementById('yesterday-items').innerText = "データ取得中にエラーが発生しました。";
            }
        }

        displayData();
    </script>
</body>
</html>
